<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Explore your Google Search Console data with insights and performance trends." />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="GSC Insights Dashboard" />
  <meta property="og:description" content="Interactive dashboard for GSC data analysis." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/assets/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="GSC Insights Dashboard" />
  <meta name="twitter:description" content="Interactive dashboard for GSC data analysis." />
  <meta name="twitter:image" content="/assets/twitter-image.jpg" />
  <title>GSC Insights Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script defer src="script.js"></script>
  <style>
    /* Your CSS here (omitted for brevity) */
  </style>
</head>
<body class="font-roboto bg-gray-50 min-h-screen">
  <div id="app" class="flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm" role="banner">
      <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-600" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39-.99 0-1.8.81-1.8 1.8s.81 1.8 1.8 1.8c.9 0 1.65-.58 1.9-1.39z"/>
          </svg>
          <h1 class="text-xl font-medium text-neutral-800">GSC Insights</h1>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Notifications Dropdown -->
          <div class="relative dropdown">
            <button id="notificationBtn" class="p-2 rounded-full hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
              <span class="material-icons text-neutral-600">notifications</span>
              <span class="notification-badge">3</span>
            </button>
            <div id="notificationDropdown" class="dropdown-content">
              <div class="p-3 border-b border-neutral-200">
                <h3 class="font-medium text-neutral-800">Notifications</h3>
              </div>
              <div class="max-h-80 overflow-y-auto">
                <div class="p-3 border-b border-neutral-100 hover:bg-neutral-50">
                  <div class="flex items-start">
                    <span class="material-icons text-red-500 mr-2">error</span>
                    <div>
                      <p class="text-sm font-medium text-neutral-800">Critical Error Detected</p>
                      <p class="text-xs text-neutral-600 mt-1">7 broken links found on your site</p>
                      <p class="text-xs text-neutral-500 mt-1">2 hours ago</p>
                    </div>
                  </div>
                </div>
                <div class="p-3 border-b border-neutral-100 hover:bg-neutral-50">
                  <div class="flex items-start">
                    <span class="material-icons text-green-500 mr-2">trending_up</span>
                    <div>
                      <p class="text-sm font-medium text-neutral-800">Traffic Increase</p>
                      <p class="text-xs text-neutral-600 mt-1">Your site traffic increased by 15% this week</p>
                      <p class="text-xs text-neutral-500 mt-1">1 day ago</p>
                    </div>
                  </div>
                </div>
                <div class="p-3 hover:bg-neutral-50">
                  <div class="flex items-start">
                    <span class="material-icons text-blue-500 mr-2">update</span>
                    <div>
                      <p class="text-sm font-medium text-neutral-800">Weekly Report Ready</p>
                      <p class="text-xs text-neutral-600 mt-1">Your weekly performance report is ready</p>
                      <p class="text-xs text-neutral-500 mt-1">2 days ago</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="p-2 border-t border-neutral-200">
                <button class="w-full text-center text-sm text-primary-600 py-1 hover:bg-primary-50 rounded">
                  View all notifications
                </button>
              </div>
            </div>
          </div>
          <!-- Profile Dropdown -->
          <div class="relative dropdown">
            <button id="profileBtn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
              <div class="h-8 w-8 rounded-full bg-primary-700 flex items-center justify-center text-white">
                <span class="text-sm font-medium">JS</span>
              </div>
              <span class="hidden md:inline text-sm font-medium text-neutral-700">John Smith</span>
              <span class="material-icons text-neutral-500 text-sm">arrow_drop_down</span>
            </button>
            <div id="profileDropdown" class="dropdown-content">
              <div class="p-3 border-b border-neutral-200">
                <div class="flex items-center space-x-3">
                  <div class="h-10 w-10 rounded-full bg-primary-700 flex items-center justify-center text-white">
                    <span class="text-sm font-medium">JS</span>
                  </div>
                  <div>
                    <p class="font-medium text-neutral-800">John Smith</p>
                    <p class="text-sm text-neutral-600">john.smith@example.com</p>
                  </div>
                </div>
              </div>
              <div class="py-1">
                <a href="#" class="flex items-center px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                  <span class="material-icons text-neutral-500 mr-3 text-sm">account_circle</span>
                  My Profile
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                  <span class="material-icons text-neutral-500 mr-3 text-sm">settings</span>
                  Settings
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                  <span class="material-icons text-neutral-500 mr-3 text-sm">help</span>
                  Help Center
                </a>
              </div>
              <div class="py-1 border-t border-neutral-200">
                <a href="#" class="flex items-center px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                  <span class="material-icons text-neutral-500 mr-3 text-sm">logout</span>
                  Sign Out
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main role="main" class="flex-grow container mx-auto px-4 py-6">
      <!-- Site Selector Dropdown -->
      <div class="mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
          <div class="mb-4 md:mb-0">
            <h2 class="text-2xl font-medium text-neutral-800">Search Console Insights</h2>
            <p class="text-neutral-600">Analyze your website's performance in Google Search</p>
          </div>
          <div class="relative dropdown">
            <div id="siteSelector" class="material-card bg-white px-4 py-2 flex items-center justify-between cursor-pointer min-w-[240px]">
              <div class="flex items-center">
                <span class="material-icons text-neutral-500 mr-2">language</span>
                <span id="selectedSite" class="text-neutral-800 font-medium">example.com</span>
              </div>
              <span class="material-icons text-neutral-500">arrow_drop_down</span>
            </div>
            <div id="siteDropdown" class="dropdown-content w-full">
              <ul class="py-1">
                <li data-site="example.com" class="px-4 py-2 hover:bg-neutral-100 flex items-center cursor-pointer">
                  <span class="material-icons text-neutral-500 mr-2">language</span>
                  <span>example.com</span>
                </li>
                <li data-site="blog.example.com" class="px-4 py-2 hover:bg-neutral-100 flex items-center cursor-pointer">
                  <span class="material-icons text-neutral-500 mr-2">language</span>
                  <span>blog.example.com</span>
                </li>
                <li data-site="store.example.com" class="px-4 py-2 hover:bg-neutral-100 flex items-center cursor-pointer">
                  <span class="material-icons text-neutral-500 mr-2">language</span>
                  <span>store.example.com</span>
                </li>
                <li id="addNewSite" class="px-4 py-2 hover:bg-neutral-100 flex items-center cursor-pointer text-primary-600">
                  <span class="material-icons text-primary-600 mr-2">add_circle</span>
                  <span>Add new property</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Date Range Selector -->
      <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
        <div class="flex space-x-2 mb-4 md:mb-0">
          <button class="date-range-btn material-btn px-4 py-2 bg-primary-600 text-white" data-range="28">Last 28 days</button>
          <button class="date-range-btn material-btn px-4 py-2 bg-white text-neutral-700 border border-neutral-300" data-range="90">Last 3 months</button>
          <button class="date-range-btn material-btn px-4 py-2 bg-white text-neutral-700 border border-neutral-300" data-range="180">Last 6 months</button>
        </div>
        <div class="flex items-center space-x-2">
          <div class="relative date-picker">
            <input type="text" id="startDate" class="px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 w-36" placeholder="2023-01-01" readonly />
            <span class="material-icons absolute right-2 top-1/2 transform -translate-y-1/2 text-neutral-500 cursor-pointer">calendar_today</span>
            <div id="startDateCalendar" class="date-picker-calendar"></div>
          </div>
          <span class="text-neutral-500">to</span>
          <div class="relative date-picker">
            <input type="text" id="endDate" class="px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 w-36" placeholder="2023-01-28" readonly />
            <span class="material-icons absolute right-2 top-1/2 transform -translate-y-1/2 text-neutral-500 cursor-pointer">calendar_today</span>
            <div id="endDateCalendar" class="date-picker-calendar"></div>
          </div>
          <button id="applyDateRange" class="material-btn px-4 py-2 bg-primary-50 text-primary-700">Apply</button>
        </div>
      </div>

      <!-- Performance Overview Cards (with tooltips) -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- ... as before ... -->
      </div>

      <!-- Main Tabs -->
      <div class="mb-6">
        <div class="border-b border-neutral-200">
          <nav class="flex space-x-8 overflow-x-auto">
            <button class="tab-btn tab-active px-1 py-4 text-sm font-medium focus:outline-none" data-tab="performance">Performance</button>
            <button class="tab-btn text-neutral-600 px-1 py-4 text-sm font-medium hover:text-neutral-800 focus:outline-none" data-tab="opportunities">Opportunities</button>
            <button class="tab-btn text-neutral-600 px-1 py-4 text-sm font-medium hover:text-neutral-800 focus:outline-none" data-tab="errors">Errors</button>
            <button class="tab-btn text-neutral-600 px-1 py-4 text-sm font-medium hover:text-neutral-800 focus:outline-none" data-tab="indexing">Indexing</button>
            <button class="tab-btn text-neutral-600 px-1 py-4 text-sm font-medium hover:text-neutral-800 focus:outline-none" data-tab="analytics">Analytics</button>
          </nav>
        </div>
      </div>

      <!-- Tab Content -->
      <div id="tabContent">
        <div id="performance" class="tab-content active">
      <!-- Performance Overview Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <!-- Total Clicks -->
  <div class="material-card bg-white p-5">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-neutral-600 font-medium">Total Clicks</h3>
      <span class="material-icons text-neutral-500 cursor-help has-tooltip" title="Number of times users clicked through to your site">
        info_outline
        <span class="tooltip-text">Number of times users clicked through to your site</span>
      </span>
    </div>
    <div class="flex items-end justify-between">
      <div>
        <p class="text-3xl font-bold text-neutral-800" id="totalClicks">--</p>
        <div class="flex items-center mt-1">
          <span id="clicksTrendIcon" class="material-icons text-green-500 text-sm">arrow_upward</span>
          <span class="text-green-500 text-sm font-medium" id="clicksChange">--</span>
          <span class="text-neutral-500 text-sm ml-1">vs previous period</span>
        </div>
      </div>
      <!-- Example: Mini bar chart, can be dynamically generated or left static -->
      <div class="h-12 flex items-end space-x-1" id="clicksMiniChart">
        <!-- Optional: mini bars via JS or static placeholder -->
      </div>
    </div>
  </div>
  <!-- Total Impressions -->
  <div class="material-card bg-white p-5">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-neutral-600 font-medium">Total Impressions</h3>
      <span class="material-icons text-neutral-500 cursor-help has-tooltip" title="Number of times your site appeared in search results">
        info_outline
        <span class="tooltip-text">Number of times your site appeared in search results</span>
      </span>
    </div>
    <div class="flex items-end justify-between">
      <div>
        <p class="text-3xl font-bold text-neutral-800" id="totalImpressions">--</p>
        <div class="flex items-center mt-1">
          <span id="impressionsTrendIcon" class="material-icons text-green-500 text-sm">arrow_upward</span>
          <span class="text-green-500 text-sm font-medium" id="impressionsChange">--</span>
          <span class="text-neutral-500 text-sm ml-1">vs previous period</span>
        </div>
      </div>
      <div class="h-12 flex items-end space-x-1" id="impressionsMiniChart"></div>
    </div>
  </div>
  <!-- Average CTR -->
  <div class="material-card bg-white p-5">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-neutral-600 font-medium">Average CTR</h3>
      <span class="material-icons text-neutral-500 cursor-help has-tooltip" title="Click-through rate: clicks divided by impressions">
        info_outline
        <span class="tooltip-text">Click-through rate: clicks divided by impressions</span>
      </span>
    </div>
    <div class="flex items-end justify-between">
      <div>
        <p class="text-3xl font-bold text-neutral-800" id="averageCTR">--</p>
        <div class="flex items-center mt-1">
          <span id="ctrTrendIcon" class="material-icons text-red-500 text-sm">arrow_downward</span>
          <span class="text-red-500 text-sm font-medium" id="ctrChange">--</span>
          <span class="text-neutral-500 text-sm ml-1">vs previous period</span>
        </div>
      </div>
      <div class="h-12 w-24 relative">
        <svg viewBox="0 0 100 100" class="w-full h-full">
          <circle cx="50" cy="50" r="45" fill="none" stroke="#e0e0e0" stroke-width="10" />
          <circle id="ctrCircle" cx="50" cy="50" r="45" fill="none" stroke="#9c27b0" stroke-width="10" stroke-dasharray="282.7" stroke-dashoffset="262.5" transform="rotate(-90 50 50)" />
          <text x="50" y="55" text-anchor="middle" font-size="20" font-weight="bold" fill="#9c27b0" id="ctrText">--</text>
        </svg>
      </div>
    </div>
  </div>
  <!-- Average Position -->
  <div class="material-card bg-white p-5">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-neutral-600 font-medium">Average Position</h3>
      <span class="material-icons text-neutral-500 cursor-help has-tooltip" title="Average ranking position in search results">
        info_outline
        <span class="tooltip-text">Average ranking position in search results</span>
      </span>
    </div>
    <div class="flex items-end justify-between">
      <div>
        <p class="text-3xl font-bold text-neutral-800" id="averagePosition">--</p>
        <div class="flex items-center mt-1">
          <span id="positionTrendIcon" class="material-icons text-green-500 text-sm">arrow_upward</span>
          <span class="text-green-500 text-sm font-medium" id="positionChange">--</span>
          <span class="text-neutral-500 text-sm ml-1">vs previous period</span>
        </div>
      </div>
      <div class="h-12 flex items-center">
        <div class="flex items-center space-x-1" id="positionMiniChart"></div>
      </div>
    </div>
  </div>
</div>

<!-- Top Performing Pages Table -->
<div class="material-card bg-white p-5 mb-8">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-medium text-neutral-800">Top Performing Pages</h3>
    <button id="viewAllPagesBtn" class="material-btn">View All</button>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full">
      <thead>
        <tr class="border-b border-neutral-200">
          <th class="py-3 text-left text-sm font-medium text-neutral-500">Page</th>
          <th class="py-3 text-right text-sm font-medium text-neutral-500">Clicks</th>
          <th class="py-3 text-right text-sm font-medium text-neutral-500">Impressions</th>
          <th class="py-3 text-right text-sm font-medium text-neutral-500">CTR</th>
          <th class="py-3 text-right text-sm font-medium text-neutral-500">Position</th>
        </tr>
      </thead>
      <tbody id="topPagesTable">
        <!-- Table rows will be dynamically inserted here by JavaScript -->
      </tbody>
    </table>
  </div>
</div>
        </div>
        <div id="opportunities" class="tab-content">
          <div class="material-card bg-white p-5 mb-8">
            <h3 class="text-lg font-medium text-neutral-800 mb-4">SEO Opportunities</h3>
            <button class="get-suggestions-btn material-btn" data-issue="SEO Opportunity">Get Suggestions</button>
          </div>
        </div>
        <div id="errors" class="tab-content">
          <div class="material-card bg-white p-5 mb-8">
            <h3 class="text-lg font-medium text-neutral-800 mb-4">Site Errors</h3>
            <button class="fix-now-btn material-btn" data-issue="404 Error">Fix Now</button>
            <button class="view-details-btn material-btn" data-issue="Slow Load">View Details</button>
            <button class="view-issues-btn material-btn" data-issue="Broken Links">View Issues</button>
          </div>
        </div>
        <div id="indexing" class="tab-content">
          <div class="material-card bg-white p-5 mb-8">
            <h3 class="text-lg font-medium text-neutral-800 mb-4">Indexing Status</h3>
            <span class="status-indicator status-good"></span> All good!
          </div>
        </div>
        <div id="analytics" class="tab-content">
          <div class="material-card bg-white p-5 mb-8">
            <h3 class="text-lg font-medium text-neutral-800 mb-4">Analytics Overview</h3>
            <button id="viewAllKeywordsBtn" class="material-btn">View All</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for dynamic popups -->
  <div id="genericModal" class="modal">
    <div class="modal-content">
      <button id="closeModal" type="button" aria-label="Close">&times;</button>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
    </div>
  </div>
</body>
  <script>
// ==== CONFIG: Set your deployed Apps Script endpoint here! ====
const API_BASE = 'YOUR_SCRIPT_URL_HERE'; // Example: 'https://script.google.com/macros/s/AKfycb.../exec'

// ==== Utility: Fetch Helper ====
async function fetchAPI(path) {
  const url = `${API_BASE}?path=${encodeURIComponent(path)}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error(`API error: ${res.status}`);
  return res.json();
}

// ==== Metrics Cards ====
async function loadMetrics() {
  try {
    const data = await fetchAPI('metrics');
    document.getElementById('totalClicks').textContent = data.totalClicks ?? '--';
    document.getElementById('clicksChange').textContent = (data.clicksChange ?? '--') + '%';
    document.getElementById('clicksTrendIcon').textContent = (data.clicksChange ?? 0) >= 0 ? 'arrow_upward' : 'arrow_downward';

    document.getElementById('totalImpressions').textContent = data.totalImpressions ?? '--';
    document.getElementById('impressionsChange').textContent = (data.impressionsChange ?? '--') + '%';
    document.getElementById('impressionsTrendIcon').textContent = (data.impressionsChange ?? 0) >= 0 ? 'arrow_upward' : 'arrow_downward';

    document.getElementById('averageCTR').textContent = (data.averageCTR ?? '--') + '%';
    document.getElementById('ctrChange').textContent = (data.ctrChange ?? '--') + '%';
    document.getElementById('ctrTrendIcon').textContent = (data.ctrChange ?? 0) >= 0 ? 'arrow_upward' : 'arrow_downward';

    document.getElementById('averagePosition').textContent = data.averagePosition ?? '--';
    document.getElementById('positionChange').textContent = data.positionChange ?? '--';
    document.getElementById('positionTrendIcon').textContent = (data.positionChange ?? 0) >= 0 ? 'arrow_upward' : 'arrow_downward';

    // Optional: Update SVG donut for CTR
    if (typeof data.averageCTR === 'number') {
      const percent = Math.max(0, Math.min(100, data.averageCTR));
      const dasharray = 282.7;
      const dashoffset = dasharray - (dasharray * percent) / 100;
      document.getElementById('ctrCircle').setAttribute('stroke-dashoffset', dashoffset);
      document.getElementById('ctrText').textContent = percent + '%';
    }

    // Optionally update mini charts if you wish
    // document.getElementById('clicksMiniChart').innerHTML = ...
  } catch (err) {
    console.error('Failed to load metrics:', err);
  }
}

// ==== Top Performing Pages Table ====
async function loadTopPages() {
  try {
    const data = await fetchAPI('top-pages');
    const tbody = document.getElementById('topPagesTable');
    tbody.innerHTML = '';
    data.topPages.forEach(page => {
      tbody.innerHTML += `
        <tr>
          <td>${page.Page || ''}</td>
          <td class="text-right">${page.Clicks ?? '--'}</td>
          <td class="text-right">${page.Impressions ?? '--'}</td>
          <td class="text-right">${page.CTR ?? '--'}%</td>
          <td class="text-right">${page.Position ?? '--'}</td>
        </tr>
      `;
    });
  } catch (err) {
    document.getElementById('topPagesTable').innerHTML = '<tr><td colspan="5">Failed to load data</td></tr>';
    console.error('Failed to load top pages:', err);
  }
}

// ==== Top Keywords Table (add element with id="topKeywordsTable" in HTML) ====
async function loadTopKeywords() {
  try {
    const data = await fetchAPI('top-keywords');
    const tbody = document.getElementById('topKeywordsTable');
    if (!tbody) return;
    tbody.innerHTML = '';
    data.topKeywords.forEach(kw => {
      tbody.innerHTML += `
        <tr>
          <td>${kw.Keyword || ''}</td>
          <td class="text-right">${kw.Clicks ?? '--'}</td>
          <td class="text-right">${kw.Impressions ?? '--'}</td>
          <td class="text-right">${kw.CTR ?? '--'}%</td>
          <td class="text-right">${kw.Position ?? '--'}</td>
        </tr>
      `;
    });
  } catch (err) {
    if (document.getElementById('topKeywordsTable'))
      document.getElementById('topKeywordsTable').innerHTML = '<tr><td colspan="5">Failed to load data</td></tr>';
    console.error('Failed to load top keywords:', err);
  }
}

// ==== Opportunities Table/List (add element with id="opportunitiesTable" in HTML) ====
async function loadOpportunities() {
  try {
    const data = await fetchAPI('opportunities');
    const tbody = document.getElementById('opportunitiesTable');
    if (!tbody) return;
    tbody.innerHTML = '';
    data.opportunities.forEach(opp => {
      tbody.innerHTML += `
        <tr>
          <td>${opp.Opportunity || ''}</td>
          <td>${opp.Description || ''}</td>
          <td>${opp.Priority || ''}</td>
        </tr>
      `;
    });
  } catch (err) {
    if (document.getElementById('opportunitiesTable'))
      document.getElementById('opportunitiesTable').innerHTML = '<tr><td colspan="3">Failed to load data</td></tr>';
    console.error('Failed to load opportunities:', err);
  }
}

// ==== Errors Table/List (add element with id="errorsTable" in HTML) ====
async function loadErrors() {
  try {
    const data = await fetchAPI('errors');
    const tbody = document.getElementById('errorsTable');
    if (!tbody) return;
    tbody.innerHTML = '';
    data.errors.forEach(errObj => {
      tbody.innerHTML += `
        <tr>
          <td>${errObj.Error || ''}</td>
          <td>${errObj.Description || ''}</td>
          <td>${errObj.Page || ''}</td>
          <td>${errObj.Status || ''}</td>
          <td>${errObj.Fix || ''}</td>
        </tr>
      `;
    });
  } catch (err) {
    if (document.getElementById('errorsTable'))
      document.getElementById('errorsTable').innerHTML = '<tr><td colspan="5">Failed to load data</td></tr>';
    console.error('Failed to load errors:', err);
  }
}

// ==== Indexing Table/List (add element with id="indexingTable" in HTML) ====
async function loadIndexing() {
  try {
    const data = await fetchAPI('indexing');
    const tbody = document.getElementById('indexingTable');
    if (!tbody) return;
    tbody.innerHTML = '';
    data.indexing.forEach(idx => {
      tbody.innerHTML += `
        <tr>
          <td>${idx.Page || ''}</td>
          <td>${idx.Status || ''}</td>
          <td>${idx.LastCrawled || ''}</td>
        </tr>
      `;
    });
  } catch (err) {
    if (document.getElementById('indexingTable'))
      document.getElementById('indexingTable').innerHTML = '<tr><td colspan="3">Failed to load data</td></tr>';
    console.error('Failed to load indexing:', err);
  }
}

// ==== Analytics Table/List (add element with id="analyticsTable" in HTML) ====
async function loadAnalytics() {
  try {
    const data = await fetchAPI('analytics');
    const tbody = document.getElementById('analyticsTable');
    if (!tbody) return;
    tbody.innerHTML = '';
    data.analytics.forEach(row => {
      tbody.innerHTML += `
        <tr>
          <td>${row.Date || ''}</td>
          <td class="text-right">${row.Clicks ?? '--'}</td>
          <td class="text-right">${row.Impressions ?? '--'}</td>
          <td class="text-right">${row.CTR ?? '--'}%</td>
          <td class="text-right">${row.Position ?? '--'}</td>
        </tr>
      `;
    });
  } catch (err) {
    if (document.getElementById('analyticsTable'))
      document.getElementById('analyticsTable').innerHTML = '<tr><td colspan="5">Failed to load data</td></tr>';
    console.error('Failed to load analytics:', err);
  }
}


// ==== INIT: Load All Data on Page Load ====

document.addEventListener('DOMContentLoaded', function() {
  loadMetrics();
  loadTopPages();
  loadTopKeywords();
  loadOpportunities();
  loadErrors();
  loadIndexing();
  loadAnalytics();
});

</script>
</html>
